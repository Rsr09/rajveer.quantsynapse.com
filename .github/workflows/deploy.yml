name: Deploy Static Website to S3

on:
  push:
    branches:
      - main   # Run pipeline only when code is pushed to main branch

permissions:
  id-token: write    # needed for OIDC authentication
  contents: read     # needed to checkout the repo

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Install dependencies (optional, only if you have build step like npm run build)
      # - name: Install Node.js
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: '18'
      #
      # - name: Build site
      #   run: npm install && npm run build

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::673181687487:role/GitHubActionsS3DeployRole
          aws-region: ap-south-1   # change if bucket is in another region

      - name: Deploy to S3
        run: |
          aws s3 sync . s3://rajveer.quantsynapse.com --delete --exclude ".git/*" --exclude ".github/*"
